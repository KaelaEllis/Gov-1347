---
title: Final Prediction
author: R package build
date: '2022-11-07'
slug: []
categories: []
tags: []
---

```{r}

```

```{r}
library(tidyverse)
library(janitor)
library(glmnet)
library(sf)
library(plotly)
library(usmap)
library(rmapshaper)
library(blogdown)
library(gridExtra)
library(stargazer)
library(lubridate)
library(dplyr)
#library(caret)
library(leaps)
library(ggthemes)
#library(usdata)
#library(gt)
#library(gtsummary)
library(cowplot)
```

```{r}
approval_rating_df <- read_csv("~/Desktop/Gov1347/Gov-1347/Final Prediction/Presidential_Approval_Rating_Midterms - Sheet1.csv")
#stargazer approval rating 

library(stargazer)
lm_ARr <- lm(Vote_Share ~ Approval_Rating + Upward, data = approval_rating_df)
lm_CSr <- lm(Vote_Share ~ consumer.sentiment + upward.cons, data = approval_rating_df)
lm_CS_wo_upward <- lm(Vote_Share ~ consumer.sentiment, data = approval_rating_df)
lm_ARr_CSr <- lm(Vote_Share ~ Approval_Rating + Upward + consumer.sentiment + upward.cons, data = approval_rating_df)
stargazer(lm_ARr, lm_CSr, lm_CS_wo_upward, lm_ARr_CSr, title = "Results", type = "text", column.labels = c("AR", "CS+trend", "CS", "AR+CS+trend"), covariate.labels = c("Approval Rating", "Approval Rating Trend", "Consumer Rating", "Consumer Rating Trend"))

data.2022 <- read_csv("~/Desktop/Gov1347/Gov-1347/Final Prediction/Presidential_approval_rating_2022 - Sheet1.csv")

model <- predict(lm_ARr, data.2022, interval="prediction")
mean(model)
```

```{r}
```{r}
#polls pls
polldata <- read_csv("~/Desktop/Gov1347/Gov-1347/Week 3/GenericPolls1942_2020.csv")
popvote_df <- read.csv("~/Desktop/Gov1347/Gov-1347/Week 2/house_popvote_seats.csv") 
popvote <- read.csv("~/Desktop/Gov1347/Gov-1347/Week 1/house pop vote 1948-2020.csv")



library(MASS)

polldata$DUE.weight <- (365 - polldata$days_until_election)

poll <- polldata %>% 
  group_by(year) %>% 
  filter(DUE.weight > 0)

poll <- poll %>% filter(days_until_election < 52)


poll$dem.2.party.poll <- (poll$dem) / (poll$rep + poll$dem) 
poll$rep.2.party.poll <- (poll$rep) / (poll$rep + poll$dem) 

#poll <- left_join(poll, popvote, by = 'year')


incumb_party <- subset(approval_rating_df, select=c('Year', 'Party'))
incumb_party <- incumb_party %>% rename("year" = "Year")


poll$Party <- ifelse(poll$year == c("1954", "1958", "1970", "1974", "1982", "1986", "1990", "2002", "2006", "2018"),  "R", "D")


#poll <- poll %>% left_join(incumb_party, poll, by = 'year')

#create a poll prediction for incumb party
poll$incumb_poll <- ifelse(poll$Party == "D", as.character(poll$dem.2.party.poll), as.character(poll$rep.2.party.poll))

poll.ed <- subset(poll, select=c('year', 'incumb_poll', 'DUE.weight'))

poll.ed <- poll.ed %>% rename("Year" = "year")

all <- poll.ed %>% left_join(approval_rating_df, poll.ed, by = 'Year')


#lm_polls_DUE_weight_incumb <- rlm(Vote_Share ~ incumb_poll, data = all, weights = DUE.weight, maxit=500)

#need it to be weighted so subtract it from 0.5 or else the numbers with a larger difference would have a larger weight
#poll$diff <- 0.5 - (poll$dem.2.party.poll - poll$D.popular_vote_pct)

#lm_polls_DUE_weight <- rlm (D.popular_vote_pct ~ dem.2.party.poll, data = poll, weights = DUE.weight)
 
#stargazer(lm_polls_DUE_weight,title = "Results", type = "text", column.labels = c("polls"), covariate.labels = c("Polls"))

#model2 <- predict(lm_polls_DUE_weight, poll, interval="prediction")
#mean(model2)


#ignored poll quality and partisan bias because of galton
```

```{r}
all$incumb_poll <- as.numeric(all$incumb_poll)
#lm_polls_DUE_weight_incumb <- rlm(Vote_Share ~ incumb_poll, data = all, weights = DUE.weight, maxit=200)
lm_incumb <- lm(Vote_Share ~ Incumbent, data = approval_rating_df)
lm_polls <- lm(Vote_Share ~ incumb_poll, data = all)
lm_all <- lm(Vote_Share ~ Approval_Rating  + consumer.sentiment + Upward + upward.cons + incumb_poll + Incumbent, data = all)
lm_ARr <- lm(Vote_Share ~ Approval_Rating + Upward, data = all)
lm_CSr <- lm(Vote_Share ~ consumer.sentiment + upward.cons, data = all)
lm_CS_wo_upward <- lm(Vote_Share ~ consumer.sentiment, data = all)
library(stargazer)
stargazer(lm_ARr, lm_CSr, lm_polls, lm_incumb, lm_all, title = "Results", type = "text", 
          column.labels = c("ApprovalRating", "ConsumerSentiment","Polls", "Incumbency", "All"), 
          covariate.labels = c("Approval Rating", "Approval Rating Trend", "Consumer Rating", "Consumer Rating Trend", "Polls", "Incumbency"))

```

