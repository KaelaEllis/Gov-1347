<!DOCTYPE html>
<html lang="en-us">
    <head>
		
		
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>Final Prediction &middot; My New Hugo Site</title>

		
		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="/css/fonts.css">
		
		<link rel="icon" href="/favicon.ico"/>
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="My New Hugo Site" />

		<script src="/js/darkmode.js"></script>
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					
						<h2 class="nav-title">My New Hugo Site</h2>
					
				</a>
				<ul>
    
    
</ul>
			</div>
		</nav>

        <div id="darkModeToggle" onclick="toggleDarkMode()">
  &#9680; 
</div>

        

<main>
	


        <div class="post">
		<div class="post-info">
    <span>Written by</span>
        R package build
        <br>
        <span>on&nbsp;</span><time datetime="2022-11-07 00:00:00 &#43;0000 UTC">November 7, 2022</time>
</div>

		<h1 class="post-title">Final Prediction</h1>
<div class="post-line"></div>

		

		


<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ ggplot2 3.3.6      ✔ purrr   0.3.4 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.4.0 
## ✔ readr   2.1.2      ✔ forcats 0.5.2 
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(janitor)</code></pre>
<pre><code>## 
## Attaching package: &#39;janitor&#39;
## 
## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<pre class="r"><code>library(glmnet)</code></pre>
<pre><code>## Loading required package: Matrix
## 
## Attaching package: &#39;Matrix&#39;
## 
## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack
## 
## Loaded glmnet 4.1-4</code></pre>
<pre class="r"><code>library(sf)</code></pre>
<pre><code>## Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE</code></pre>
<pre class="r"><code>library(plotly)</code></pre>
<pre><code>## 
## Attaching package: &#39;plotly&#39;
## 
## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     last_plot
## 
## The following object is masked from &#39;package:stats&#39;:
## 
##     filter
## 
## The following object is masked from &#39;package:graphics&#39;:
## 
##     layout</code></pre>
<pre class="r"><code>library(usmap)
library(rmapshaper)</code></pre>
<pre><code>## Registered S3 method overwritten by &#39;geojsonlint&#39;:
##   method         from 
##   print.location dplyr</code></pre>
<pre class="r"><code>library(blogdown)
library(gridExtra)</code></pre>
<pre><code>## 
## Attaching package: &#39;gridExtra&#39;
## 
## The following object is masked from &#39;package:dplyr&#39;:
## 
##     combine</code></pre>
<pre class="r"><code>library(stargazer)</code></pre>
<pre><code>## 
## Please cite as: 
## 
##  Hlavac, Marek (2022). stargazer: Well-Formatted Regression and Summary Statistics Tables.
##  R package version 5.2.3. https://CRAN.R-project.org/package=stargazer</code></pre>
<pre class="r"><code>library(lubridate)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre class="r"><code>library(dplyr)
#library(caret)
library(leaps)
library(ggthemes)
#library(usdata)
#library(gt)
#library(gtsummary)
library(cowplot)</code></pre>
<pre><code>## 
## Attaching package: &#39;cowplot&#39;
## 
## The following object is masked from &#39;package:ggthemes&#39;:
## 
##     theme_map
## 
## The following object is masked from &#39;package:lubridate&#39;:
## 
##     stamp</code></pre>
<pre class="r"><code>approval_rating_df &lt;- read_csv(&quot;~/Desktop/Gov1347/Gov-1347/Final Prediction/Presidential_Approval_Rating_Midterms - Sheet1.csv&quot;)</code></pre>
<pre><code>## Rows: 19 Columns: 11
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): President, Party
## dbl (9): Year, Approval_Rating, Upward, Seats, Vote_Share, consumer.sentimen...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>#stargazer approval rating 

library(stargazer)
lm_ARr &lt;- lm(Vote_Share ~ Approval_Rating + Upward, data = approval_rating_df)
lm_CSr &lt;- lm(Vote_Share ~ consumer.sentiment + upward.cons, data = approval_rating_df)
lm_CS_wo_upward &lt;- lm(Vote_Share ~ consumer.sentiment, data = approval_rating_df)
lm_ARr_CSr &lt;- lm(Vote_Share ~ Approval_Rating + Upward + consumer.sentiment + upward.cons, data = approval_rating_df)
stargazer(lm_ARr, lm_CSr, lm_CS_wo_upward, lm_ARr_CSr, title = &quot;Results&quot;, type = &quot;text&quot;, column.labels = c(&quot;AR&quot;, &quot;CS+trend&quot;, &quot;CS&quot;, &quot;AR+CS+trend&quot;), covariate.labels = c(&quot;Approval Rating&quot;, &quot;Approval Rating Trend&quot;, &quot;Consumer Rating&quot;, &quot;Consumer Rating Trend&quot;))</code></pre>
<pre><code>## 
## Results
## =================================================================================================
##                                                   Dependent variable:                            
##                       ---------------------------------------------------------------------------
##                                                       Vote_Share                                 
##                               AR              CS+trend              CS            AR+CS+trend    
##                              (1)                (2)                (3)                (4)        
## -------------------------------------------------------------------------------------------------
## Approval Rating             0.002                                                    0.007       
##                            (0.092)                                                  (0.100)      
##                                                                                                  
## Approval Rating Trend       1.173                                                    -0.651      
##                            (2.166)                                                  (2.684)      
##                                                                                                  
## Consumer Rating                                0.096              0.040              0.109       
##                                               (0.082)            (0.077)            (0.104)      
##                                                                                                  
## Consumer Rating Trend                          -3.028                                -3.278      
##                                               (1.954)                               (2.411)      
##                                                                                                  
## Constant                  47.611***          41.244***          44.535***          40.052***     
##                            (4.821)            (6.569)            (6.501)            (9.512)      
##                                                                                                  
## -------------------------------------------------------------------------------------------------
## Observations                  18                 17                 17                 17        
## R2                          0.020              0.161              0.017              0.166       
## Adjusted R2                 -0.111             0.042              -0.048             -0.112      
## Residual Std. Error    3.804 (df = 15)    3.604 (df = 14)    3.769 (df = 15)    3.883 (df = 12)  
## F Statistic           0.149 (df = 2; 15) 1.346 (df = 2; 14) 0.265 (df = 1; 15) 0.596 (df = 4; 12)
## =================================================================================================
## Note:                                                                 *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
<pre class="r"><code>data.2022 &lt;- read_csv(&quot;~/Desktop/Gov1347/Gov-1347/Final Prediction/Presidential_approval_rating_2022 - Sheet1.csv&quot;)</code></pre>
<pre><code>## Rows: 1 Columns: 8
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): President, Party
## dbl (6): Year, Approval_Rating, Upward, consumer.sentiment, upward.cons, Inc...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>model &lt;- predict(lm_ARr, data.2022, interval=&quot;prediction&quot;)
mean(model)</code></pre>
<pre><code>## [1] 47.68857</code></pre>
<pre class="r"><code>#polls pls
polldata &lt;- read_csv(&quot;~/Desktop/Gov1347/Gov-1347/Week 3/GenericPolls1942_2020.csv&quot;)</code></pre>
<pre><code>## Rows: 2707 Columns: 11
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): pollster, type
## dbl (9): sample_size, dem, rep, bmonth, bday, year, emonth, eday, days_until...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>popvote_df &lt;- read.csv(&quot;~/Desktop/Gov1347/Gov-1347/Week 2/house_popvote_seats.csv&quot;) 
popvote &lt;- read.csv(&quot;~/Desktop/Gov1347/Gov-1347/Week 1/house pop vote 1948-2020.csv&quot;)



library(MASS)</code></pre>
<pre><code>## 
## Attaching package: &#39;MASS&#39;
## 
## The following object is masked from &#39;package:plotly&#39;:
## 
##     select
## 
## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<pre class="r"><code>polldata$DUE.weight &lt;- (365 - polldata$days_until_election)

poll &lt;- polldata %&gt;% 
  group_by(year) %&gt;% 
  filter(DUE.weight &gt; 0)

poll &lt;- poll %&gt;% filter(days_until_election &lt; 52)


poll$dem.2.party.poll &lt;- (poll$dem) / (poll$rep + poll$dem) 
poll$rep.2.party.poll &lt;- (poll$rep) / (poll$rep + poll$dem) 

#poll &lt;- left_join(poll, popvote, by = &#39;year&#39;)


incumb_party &lt;- subset(approval_rating_df, select=c(&#39;Year&#39;, &#39;Party&#39;))
incumb_party &lt;- incumb_party %&gt;% rename(&quot;year&quot; = &quot;Year&quot;)


poll$Party &lt;- ifelse(poll$year == c(&quot;1954&quot;, &quot;1958&quot;, &quot;1970&quot;, &quot;1974&quot;, &quot;1982&quot;, &quot;1986&quot;, &quot;1990&quot;, &quot;2002&quot;, &quot;2006&quot;, &quot;2018&quot;),  &quot;R&quot;, &quot;D&quot;)


#poll &lt;- poll %&gt;% left_join(incumb_party, poll, by = &#39;year&#39;)

#create a poll prediction for incumb party
poll$incumb_poll &lt;- ifelse(poll$Party == &quot;D&quot;, as.character(poll$dem.2.party.poll), as.character(poll$rep.2.party.poll))

poll.ed &lt;- subset(poll, select=c(&#39;year&#39;, &#39;incumb_poll&#39;, &#39;DUE.weight&#39;))

poll.ed &lt;- poll.ed %&gt;% rename(&quot;Year&quot; = &quot;year&quot;)

all &lt;- poll.ed %&gt;% left_join(approval_rating_df, poll.ed, by = &#39;Year&#39;)


#lm_polls_DUE_weight_incumb &lt;- rlm(Vote_Share ~ incumb_poll, data = all, weights = DUE.weight, maxit=500)

#need it to be weighted so subtract it from 0.5 or else the numbers with a larger difference would have a larger weight
#poll$diff &lt;- 0.5 - (poll$dem.2.party.poll - poll$D.popular_vote_pct)

#lm_polls_DUE_weight &lt;- rlm (D.popular_vote_pct ~ dem.2.party.poll, data = poll, weights = DUE.weight)
 
#stargazer(lm_polls_DUE_weight,title = &quot;Results&quot;, type = &quot;text&quot;, column.labels = c(&quot;polls&quot;), covariate.labels = c(&quot;Polls&quot;))

#model2 &lt;- predict(lm_polls_DUE_weight, poll, interval=&quot;prediction&quot;)
#mean(model2)


#ignored poll quality and partisan bias because of galton</code></pre>
<pre class="r"><code>all$incumb_poll &lt;- as.numeric(all$incumb_poll)
#lm_polls_DUE_weight_incumb &lt;- rlm(Vote_Share ~ incumb_poll, data = all, weights = DUE.weight, maxit=200)
lm_incumb &lt;- lm(Vote_Share ~ Incumbent, data = approval_rating_df)
lm_polls &lt;- lm(Vote_Share ~ incumb_poll, data = all)
lm_all &lt;- lm(Vote_Share ~ Approval_Rating  + consumer.sentiment + Upward + upward.cons + incumb_poll + Incumbent, data = all)
lm_ARr &lt;- lm(Vote_Share ~ Approval_Rating + Upward, data = all)
lm_CSr &lt;- lm(Vote_Share ~ consumer.sentiment + upward.cons, data = all)
lm_CS_wo_upward &lt;- lm(Vote_Share ~ consumer.sentiment, data = all)
library(stargazer)
stargazer(lm_ARr, lm_CSr, lm_polls, lm_incumb, lm_all, title = &quot;Results&quot;, type = &quot;text&quot;, 
          column.labels = c(&quot;ApprovalRating&quot;, &quot;ConsumerSentiment&quot;,&quot;Polls&quot;, &quot;Incumbency&quot;, &quot;All&quot;), 
          covariate.labels = c(&quot;Approval Rating&quot;, &quot;Approval Rating Trend&quot;, &quot;Consumer Rating&quot;, &quot;Consumer Rating Trend&quot;, &quot;Polls&quot;, &quot;Incumbency&quot;))</code></pre>
<pre><code>## 
## Results
## ==============================================================================================================================================
##                                                                         Dependent variable:                                                   
##                       ------------------------------------------------------------------------------------------------------------------------
##                                                                              Vote_Share                                                       
##                           ApprovalRating         ConsumerSentiment              Polls                Incumbency                 All           
##                                 (1)                     (2)                      (3)                    (4)                     (5)           
## ----------------------------------------------------------------------------------------------------------------------------------------------
## Approval Rating              0.117***                                                                                         0.175***        
##                               (0.013)                                                                                         (0.009)         
##                                                                                                                                               
## Approval Rating Trend        -1.188***                                                                                         -0.139         
##                               (0.348)                                                                                         (0.331)         
##                                                                                                                                               
## Consumer Rating                                      -0.091***                                                               -0.066***        
##                                                       (0.012)                                                                 (0.012)         
##                                                                                                                                               
## Consumer Rating Trend                                -3.000***                                                               -1.125***        
##                                                       (0.275)                                                                 (0.330)         
##                                                                                                                                               
## Polls                                                                        -23.582***                                      -5.870***        
##                                                                                (2.824)                                        (1.394)         
##                                                                                                                                               
## Incumbency                                                                                            0.091***                0.121***        
##                                                                                                       (0.023)                 (0.004)         
##                                                                                                                                               
## Constant                     43.003***               57.563***                60.953***              30.702***               24.969***        
##                               (0.624)                 (0.979)                  (1.500)                (4.387)                 (1.676)         
##                                                                                                                                               
## ----------------------------------------------------------------------------------------------------------------------------------------------
## Observations                    427                     420                      427                     18                     420           
## R2                             0.170                   0.420                    0.141                  0.497                   0.828          
## Adjusted R2                    0.167                   0.418                    0.139                  0.466                   0.825          
## Residual Std. Error      2.995 (df = 424)         2.520 (df = 417)        3.044 (df = 425)        2.638 (df = 16)         1.380 (df = 413)    
## F Statistic           43.557*** (df = 2; 424) 151.199*** (df = 2; 417) 69.717*** (df = 1; 425) 15.817*** (df = 1; 16) 331.012*** (df = 6; 413)
## ==============================================================================================================================================
## Note:                                                                                                              *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>


		
	</div>

	<div class="pagination">
		<a href="/post/2022-10-23-blog-post-7/" class="left arrow">&#8592;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			
			<span>
			&copy; <time datetime="2022-11-07 11:43:28.157584 -0500 EST m=&#43;0.179732792">2022</time> . Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
